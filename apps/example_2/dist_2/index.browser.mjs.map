{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": [
    "/**\n * @squoosh-kit/avif public API\n */\n\nimport type { ImageInput } from '@squoosh-kit/runtime';\nimport { createBridge } from './bridge';\nimport type { AvifEncodeInputOptions } from './types';\n\nexport type { ImageInput, AvifEncodeInputOptions };\n\nlet globalClientBridge: ReturnType<typeof createBridge> | null = null;\n\n/**\n * An AVIF image encoder that can be reused for multiple operations.\n * Can be terminated to clean up associated resources (especially workers).\n */\nexport type AvifEncoderFactory = ((\n  imageData: ImageInput,\n  options?: AvifEncodeInputOptions,\n  signal?: AbortSignal\n) => Promise<Uint8Array>) & {\n  /**\n   * Terminates the encoder and cleans up resources.\n   * Important for worker mode to prevent memory leaks.\n   */\n  terminate(): Promise<void>;\n};\n\n/**\n * An AVIF image decoder that can be reused for multiple operations.\n * Can be terminated to clean up associated resources (especially workers).\n */\nexport type AvifDecoderFactory = ((\n  buffer: BufferSource,\n  signal?: AbortSignal\n) => Promise<ImageData>) & {\n  /**\n   * Terminates the decoder and cleans up resources.\n   * Important for worker mode to prevent memory leaks.\n   */\n  terminate(): Promise<void>;\n};\n\n/**\n * Encodes an image to AVIF format. Uses worker mode for UI responsiveness.\n *\n * @param imageData - The image data to encode.\n * @param options - AVIF encoding options.\n * @param signal - (Optional) AbortSignal to cancel the encoding operation.\n * @returns A Promise resolving to the encoded AVIF data as a Uint8Array.\n */\nexport async function encode(\n  imageData: ImageInput,\n  options?: AvifEncodeInputOptions,\n  signal?: AbortSignal\n): Promise<Uint8Array> {\n  if (!globalClientBridge) {\n    globalClientBridge = createBridge('worker');\n  }\n  return globalClientBridge.encode(imageData, options, signal);\n}\n\n/**\n * Decodes AVIF data to image data. Uses worker mode for UI responsiveness.\n *\n * @param buffer - The AVIF file data to decode.\n * @param signal - (Optional) AbortSignal to cancel the decoding operation.\n * @returns A Promise resolving to the decoded image data.\n */\nexport async function decode(\n  buffer: BufferSource,\n  signal?: AbortSignal\n): Promise<ImageData> {\n  if (!globalClientBridge) {\n    globalClientBridge = createBridge('worker');\n  }\n  return globalClientBridge.decode(buffer, signal);\n}\n\n/**\n * Creates a reusable AVIF encoder function for a specific execution mode.\n *\n * @param mode - The execution mode, either 'worker' or 'client'.\n * @returns A function that encodes an image to AVIF format with optional AbortSignal.\n */\nexport function createAvifEncoder(\n  mode: 'worker' | 'client' = 'worker'\n): AvifEncoderFactory {\n  const bridge = createBridge(mode);\n\n  return Object.assign(\n    (\n      imageData: ImageInput,\n      options?: AvifEncodeInputOptions,\n      signal?: AbortSignal\n    ) => {\n      return bridge.encode(imageData, options, signal);\n    },\n    {\n      terminate: async () => {\n        await bridge.terminate();\n      },\n    }\n  );\n}\n\n/**\n * Creates a reusable AVIF decoder function for a specific execution mode.\n *\n * @param mode - The execution mode, either 'worker' or 'client'.\n * @returns A function that decodes AVIF data with optional AbortSignal.\n */\nexport function createAvifDecoder(\n  mode: 'worker' | 'client' = 'worker'\n): AvifDecoderFactory {\n  const bridge = createBridge(mode);\n\n  return Object.assign(\n    (buffer: BufferSource, signal?: AbortSignal) => {\n      return bridge.decode(buffer, signal);\n    },\n    {\n      terminate: async () => {\n        await bridge.terminate();\n      },\n    }\n  );\n}\n"
  ],
  "mappings": "6GAUA,FAAI,JAA6D,KAyCjE,eAAsB,CAAM,CAC1B,EACA,EACA,EACqB,CACrB,GAAI,CAAC,EACH,EAAqB,EAAa,QAAQ,EAE5C,OAAO,EAAmB,OAAO,EAAW,EAAS,CAAM,EAU7D,eAAsB,CAAM,CAC1B,EACA,EACoB,CACpB,GAAI,CAAC,EACH,EAAqB,EAAa,QAAQ,EAE5C,OAAO,EAAmB,OAAO,EAAQ,CAAM,EAS1C,SAAS,CAAiB,CAC/B,EAA4B,SACR,CACpB,IAAM,EAAS,EAAa,CAAI,EAEhC,OAAO,OAAO,OACZ,CACE,EACA,EACA,IACG,CACH,OAAO,EAAO,OAAO,EAAW,EAAS,CAAM,GAEjD,CACE,UAAW,SAAY,CACrB,MAAM,EAAO,UAAU,EAE3B,CACF,EASK,SAAS,CAAiB,CAC/B,EAA4B,SACR,CACpB,IAAM,EAAS,EAAa,CAAI,EAEhC,OAAO,OAAO,OACZ,CAAC,EAAsB,IAAyB,CAC9C,OAAO,EAAO,OAAO,EAAQ,CAAM,GAErC,CACE,UAAW,SAAY,CACrB,MAAM,EAAO,UAAU,EAE3B,CACF",
  "debugId": "391F37731D6832E064756E2164756E21",
  "names": []
}